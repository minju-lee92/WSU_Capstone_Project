---
title: "simple_stat"
author: "Jessica Hosler"
date: "3/26/2020"
output:
  pdf_document: default
  word_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r}
# load necessary packages
library(readxl)

# read in Customer Infor table
CustomerInfo <- read_excel("Data/WSU Capstone Project - Working Data.xlsx", 
    sheet = "Customer Info")
# View(CustomerInfo)

# change customer size name in data table to make it easier to call for merging
names(CustomerInfo)[names(CustomerInfo) == "Customer Size"] <- "Customer.Size"

# output number of objects for each of the different customer sizes
as.data.frame(table(CustomerInfo$`Customer.Size`))

```

```{r}
# load necessary packages
library(readxl)

# read in Table A
Table_A <- read_excel("Data/WSU Capstone Project - Working Data.xlsx", 
    sheet = "Table A")
# View(Table_A)

# convert numeric data types to corresponding char values
Table_A$Type[Table_A$Type == '0'] <- 'A'
Table_A$Type[Table_A$Type == '1'] <- 'B'

# output number of objects for each data type
as.data.frame(table(Table_A$Type))

```


```{r}
# load necessary packages
library(openxlsx)
library(dplyr)

# read in Table B
Table_B <- read.xlsx("Data/WSU Capstone Project - Working Data.xlsx", sheet = "Table B")
#View(Table_B)

# change Customer Key to match the same name as Customer Info to allow for merging
names(Table_B)[names(Table_B) == "Customer.Key"] <- "Customer ID"

```


```{r Table_B,CustomerInfo}

# calculate the overall early, on-time, and late percentages for full dataset
sums <- colSums(Table_B[,4:7])
early = round((sums[2]/sums[1]),digits=2)
on_time = round((sums[4]/sums[1]),digits=2)
late = round((sums[3]/sums[1]),digits=2)

# create a new table that merges cusstomer info with table B on customer ID
Delivery_Table <- merge(CustomerInfo,Table_B,by="Customer ID")
#View(Delivery_Table)

# create a table for customer size 0
Size_0 <- Delivery_Table %>%
  filter(Customer.Size == '0')

# calculate the percentage of early, late and on-time items for customer size 0
sums_0 <- colSums(Size_0[,6:9])
early_0 = round((sums_0[2]/sums_0[1]),digits=2)
on_time_0 = round((sums_0[4]/sums_0[1]),digits=2)
late_0 = round((sums_0[3]/sums_0[1]),digits=2)

# create a table for customer size 1
Size_1 <- Delivery_Table %>%
  filter(Customer.Size == '1')

# calculate the percentage of early, late and on-time items for customer size 1
sums_1 <- colSums(Size_1[,6:9])
early_1 = round((sums_1[2]/sums_1[1]),digits=2)
on_time_1 = round((sums_1[4]/sums_1[1]),digits=2)
late_1 = round((sums_1[3]/sums_1[1]),digits=2)

# create a table for customer size 2
Size_2 <- Delivery_Table %>%
  filter(Customer.Size == '2')

# calculate the percentage of early, late and on-time items for customer size 2
sums_2 <- colSums(Size_2[,6:9])
early_2 = round((sums_2[2]/sums_2[1]),digits=2)
on_time_2 = round((sums_2[4]/sums_2[1]),digits=2)
late_2 = round((sums_2[3]/sums_2[1]), digits=2)

# create a table for customer size 3
Size_3 <- Delivery_Table %>%
  filter(Customer.Size == '3')

# calculate the percentage of early, late and on-time items for customer size 3
sums_3 <- colSums(Size_3[,6:9])
early_3 = round((sums_3[2]/sums_3[1]),digits=2)
on_time_3 = round((sums_3[4]/sums_3[1]),digits=2)
late_3 = round((sums_3[3]/sums_3[1]),digits=2)

# create a table with the percentages for early, on-time, and late of each customer size
size = c("overall","0","1","2","3")
perc_earl = c(early,early_0,early_1,early_2,early_3)
perc_on_time = c(on_time, on_time_0, on_time_1,on_time_2,on_time_3)
perc_late = c(late, late_0,late_1,late_2,late_3)

delivery_percentages <- cbind(size,perc_earl,perc_on_time,perc_late)
View(delivery_percentages)
```

```{r}
# load necessary packages
library(readxl)
library(dplyr)

# read in Table D
Table_D <- read_excel("Data/WSU Capstone Project - Working Data.xlsx", 
    sheet = "Table D")
#View(Table_D)

# convert the numeric data types to alphabetical to allow for merging if desired
Table_D$Type[Table_D$Type == '0'] <- 'A'
Table_D$Type[Table_D$Type == '1'] <- 'B'

# return the number of objects for each data type
as.data.frame(table(Table_D$Type))

```


```{r}
# load necessary packages
library(readxl)
library(lubridate)

# read in Table E
Table_E <- read_excel("Data/WSU Capstone Project - Working Data.xlsx", 
    sheet = "Table E", col_types = c("numeric", 
        "numeric", "date", "date", "numeric", 
        "numeric", "numeric"))
# View(Table_E)

# convert numeric data types to corresponding char values
Table_E$Type[Table_E$Type == '0'] <- 'A'
Table_E$Type[Table_E$Type == '1'] <- 'B'

# output number of objects for each data type
as.data.frame(table(Table_E$Type))

#change Company column name to match the corresponding column in Customer info
names(Table_E)[names(Table_E) == "Company"] <- "Customer ID"

```

```{r CustomerInfo, Table_E}
# load necessary packages
library(dplyr)

# create a new table from customer info and table E
date_elapsed_table <- merge(CustomerInfo,Table_E,by="Customer ID")

# create new column for days elapsed for orders
names(date_elapsed_table)[names(date_elapsed_table) == "Column1"] <- "Days Elapsed"

# calculate the number of days elapsed for each order and add to Days Elapsed column
date_elapsed_table$`Days Elapsed` <- as.numeric(difftime(date_elapsed_table$Closed,date_elapsed_table$Open, units="days"))
# View(date_elapsed_table)

# calculate overall datasets average days to complete an order
counts = dim(date_elapsed_table)
date_counts <- colSums(date_elapsed_table[,8:9], na.rm = TRUE)
avg_days_overall = round((date_counts[1]/counts[1]), digits=0)

# create a table for customer size 0 and calculate the avg days to complete orders
Size_0 <- date_elapsed_table %>%
  filter(Customer.Size == '0')
Size_0
count_0 = dim(Size_0)
days_0 = colSums(Size_0[,8:9], na.rm = TRUE)
avg_days_0 = round((days_0[1]/count_0[1]),digits=0)

# create a table for customer size 1 and calculate the avg days to complete orders
Size_1 <- date_elapsed_table %>%
  filter(Customer.Size == '1')
count_1 = dim(Size_1)
days_1 = colSums(Size_1[,8:9], na.rm = TRUE)
avg_days_1 = round((days_1[1]/count_1[1]),digits=0)

# create a table for customer size 2 and calculate the avg days to complete orders
Size_2 <- date_elapsed_table %>%
  filter(Customer.Size == '2')
count_2 = dim(Size_2)
days_2 = colSums(Size_2[,8:9], na.rm = TRUE)
avg_days_2 = round((days_2[1]/count_2[1]),digits=0)

# create a table for customer size 3 and calculate the avg days to complete orders
Size_3 <- date_elapsed_table %>%
  filter(Customer.Size == '3')
count_3 = dim(Size_3)
days_3 = colSums(Size_3[,8:9], na.rm = TRUE)
avg_days_3 = round((days_3[1]/count_3[1]),digits=0)

# create a table to display the avg elapsed days for each customer size and whole dataset
size = c("Overall","0","1","2","3")
avg_order_days = c(avg_days_overall,avg_days_0,avg_days_1,avg_days_2,avg_days_3)
avg_days_table = cbind(size,avg_order_days)
View(avg_days_table)

```
